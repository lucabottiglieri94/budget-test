<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Grafico Risparmi</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #f5f6fa;
}

.container {
    max-width: 900px;
    margin: auto;
    background: white;
    padding: 25px;
    border-radius: 14px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

h1 {
    text-align: center;
    margin-bottom: 20px;
}

.total {
    text-align: center;
    font-size: 22px;
    font-weight: bold;
    margin-top: 20px;
}
</style>
</head>
<body>

<div class="container">
    <h1>ðŸ“ˆ Risparmio Mensile</h1>
    <canvas id="savingsChart"></canvas>
    <div class="total" id="yearTotal">Totale anno: 0 â‚¬</div>
</div>

<script type="module">


import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
   
    apiKey: "AIzaSyAdZbBv6JYbYnl6CxuFVfHhSftvIxwf2DY",
    authDomain: "budget-luca.firebaseapp.com",
    projectId: "budget-luca",
    storageBucket: "budget-luca.firebasestorage.app",
    messagingSenderId: "67496424698",
    appId: "1:67496424698:web:b1822e04ef4efc07408543",
    measurementId: "G-7LEYRZE9QN"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ====== LOGICA CALCOLO RISPARMI ====== */

const mesi = [
"Gen", "Feb", "Mar", "Apr", "Mag", "Giu",
"Lug", "Ago", "Set", "Ott", "Nov", "Dic"
];

const risparmioPerMese = new Array(12).fill(0);

async function caricaDati() {

    // stessa collection che usi per movimenti
    const snap = await getDocs(collection(db, "movimenti"));

    snap.forEach(doc => {
        const d = doc.data();

        if (!d.data || !d.importo) return;

        const mese = new Date(d.data).getMonth();

        // ENTRATE positive â†’ contribuiscono al risparmio
        // USCITE negative â†’ riducono risparmio
        risparmioPerMese[mese] += Number(d.importo);
    });

    disegnaGrafico();
}

function disegnaGrafico() {

    const totaleAnno = risparmioPerMese.reduce((a,b)=>a+b,0);

    document.getElementById("yearTotal").innerText =
        "Totale anno: " + totaleAnno.toFixed(2) + " â‚¬";

    new Chart(document.getElementById("savingsChart"), {
        type: "bar",
        data: {
            labels: mesi,
            datasets: [{
                label: "Risparmio â‚¬",
                data: risparmioPerMese
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
}

caricaDati();

</script>

</body>
</html>

