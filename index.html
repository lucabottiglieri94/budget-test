<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget Mensile - Gestione Familiare</title>
<style>
:root {
    --color-primary: #2196F3;
    --color-success: #4CAF50;
    --color-danger: #F44336;
    --color-warning: #FF9800;
    --color-light: #f5f5f5;
    --color-dark: #333;
    --color-border: #ddd;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: var(--color-dark);
    display: flex;
    justify-content: center;
}
.container {
    width: 100%;
    max-width: 1200px;
    background: white;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}
header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px 20px;
    text-align: center;
    position: sticky;
    top: 0;
    z-index: 1000;
}
header h1 { font-size: 1.8em; margin-bottom: 5px; }
header p { font-size: 0.85em; opacity: 0.95; }
header button {
    background: white; color: #764ba2; border: none; padding: 8px 12px;
    border-radius: 10px; cursor: pointer; font-weight: 700; margin-top: 10px;
}
.content {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 18px;
}
.section {
    background: var(--color-light);
    padding: 20px;
    border-radius: 15px;
    border-left: 5px solid var(--color-primary);
}
.section.entrate { border-left-color: var(--color-success); }
.section.spese { border-left-color: var(--color-danger); }
.section h2 { margin-bottom: 15px; display: flex; align-items: center; gap: 8px; font-size: 1.25em; }
.entry-items { display: flex; flex-direction: column; gap: 10px; margin-bottom: 12px; }
.entry-item {
    background: white;
    padding: 12px;
    border-radius: 10px;
    display: flex;
    gap: 8px;
    align-items: center;
    border: 1px solid var(--color-border);
}
.item-label-input, .item-amount-input {
    padding: 8px; border-radius: 8px; font-size: 0.95em;
}
.item-label-input { flex: 1; font-weight: 600; }
.item-amount-input { width: 90px; text-align: right; font-weight: 600; }
.btn-remove { background: var(--color-danger); color: white; border: none; padding: 8px 10px; border-radius: 8px; cursor: pointer; font-size: 0.9em; }
.btn-add { width: 100%; padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 0.95em; margin-bottom: 12px; color: white; }
.btn-add-entrate { background: var(--color-success); }
.btn-add-spese { background: var(--color-danger); }
.total-row { background: white; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; border: 2px solid var(--color-primary); font-weight: 700; margin-top: 8px; }
.summary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    border-radius: 15px;
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 12px;
    text-align: center;
}
.summary-card {
    background: rgba(255,255,255,0.15);
    padding: 15px;
    border-radius: 12px;
    backdrop-filter: blur(10px);
}
.summary-label { font-size: 0.8em; opacity: 0.9; margin-bottom: 6px; font-weight: 600; }
.summary-value { font-size: 1.5em; font-weight: 700; }
.balance-positive { color: #4CAF50; }
.balance-negative { color: #FF6B6B; }
#risparmi-btn, #comparatori-btn {
    position: fixed; bottom: 20px; padding: 10px 18px; border-radius: 999px; border: none; font-weight: 700; cursor: pointer; z-index: 1500;
}
#risparmi-btn { left: 20px; background: #ff9800; color: #fff; }
#comparatori-btn { right: 20px; background: #4CAF50; color: #fff; }
#ai-coin { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); width: 80px; cursor: pointer; z-index: 1600; animation: floatCoin 2s ease-in-out infinite alternate; }
@keyframes floatCoin { 0% { transform: translateX(-50%) translateY(0px) rotate(0deg); } 100% { transform: translateX(-50%) translateY(-10px) rotate(15deg); } }
#ai-bubble { position: fixed; bottom: 200px; left: 50%; transform: translateX(-50%); background: #fff; padding: 12px 18px; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.2); max-width: 260px; text-align: center; font-size: 0.85em; color: #333; display: none; z-index: 1700; }
</style>
</head>
<body>
<div class="container">
<header>
    <h1>ðŸ’° Budget Mensile</h1>
    <p>Gestione entrate e spese familiari (sincronizzato)</p>
    <button id="login-btn">ðŸ”‘ Accedi con Google</button>
</header>

<div class="content">
    <button id="risparmi-btn" onclick="location.href='risparmi.html'">ðŸ“ˆ Grafico Risparmi</button>
    <button id="comparatori-btn" onclick="location.href='comparatori.html'">ðŸ“Š Comparatori</button>

    <div class="section entrate">
        <h2>ðŸ“¥ Entrate</h2>
        <div class="entry-items" id="entrate-items"></div>
        <button class="btn-add btn-add-entrate" onclick="addEntryItem('entrate')">+ Aggiungi Entrata</button>
        <div class="total-row"><span>Totale Entrate</span><span id="total-entrate">â‚¬ 0,00</span></div>
    </div>

    <div class="section spese">
        <h2>ðŸ“¤ Spese</h2>
        <div class="entry-items" id="spese-items"></div>
        <button class="btn-add btn-add-spese" onclick="addEntryItem('spese')">+ Aggiungi Spesa</button>
        <div class="total-row"><span>Totale Spese</span><span id="total-spese">â‚¬ 0,00</span></div>
    </div>

    <div class="summary">
        <div class="summary-card"><div class="summary-label">ðŸ“¥ Entrate</div><div class="summary-value" id="summary-entrate">â‚¬ 0,00</div></div>
        <div class="summary-card"><div class="summary-label">ðŸ“¤ Spese</div><div class="summary-value" id="summary-spese">â‚¬ 0,00</div></div>
        <div class="summary-card"><div class="summary-label">ðŸ’¾ Risparmio</div><div class="summary-value balance-positive" id="summary-balance">â‚¬ 0,00</div></div>
    </div>
</div>
</div>

<img id="ai-coin" src="https://upload.wikimedia.org/wikipedia/commons/1/17/2_euro_coin.png" alt="Moneta AI">
<div id="ai-bubble">ðŸ’¡ Consiglio AI: Puoi risparmiare ancora â‚¬100 questo mese! ðŸ’°</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyAdZbBv6JYbYnl6CxuFVfHhSftvIxwf2DY",
    authDomain: "budget-luca.firebaseapp.com",
    projectId: "budget-luca",
    storageBucket: "budget-luca.firebasestorage.app",
    messagingSenderId: "67496424698",
    appId: "1:67496424698:web:b1822e04ef4efc07408543",
    measurementId: "G-7LEYRZE9QN"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

let currentUser = null;
onAuthStateChanged(auth, user => { currentUser = user; loginBtn.textContent = user ? "âœ… Loggato" : "ðŸ”‘ Accedi con Google"; });

const loginBtn = document.getElementById("login-btn");
loginBtn.onclick = () => { if(!currentUser) signInWithPopup(auth, provider); };

const aiCoin = document.getElementById('ai-coin');
const aiBubble = document.getElementById('ai-bubble');
aiCoin.addEventListener('click', async () => {
    if(!currentUser) { alert("Accedi per ricevere i consigli AI!"); return; }
    const ref = doc(db, "budgets", "2026-02");
    const snap = await getDoc(ref);
    let balance = 0;
    if(snap.exists()) {
        const data = snap.data();
        const totalEntrate = data.entrate?.reduce((a,b)=>a+parseFloat(b.amount||0),0)||0;
        const totalSpese = data.spese?.reduce((a,b)=>a+parseFloat(b.amount||0),0)||0;
        balance = totalEntrate - totalSpese;
    }
    aiBubble.textContent = `ðŸ’¡ Consiglio AI: Puoi ancora risparmiare circa â‚¬${(balance*0.3).toFixed(2)} questo mese! ðŸ’°`;
    aiBubble.style.display = 'block';
    setTimeout(()=>{ aiBubble.style.display='none'; }, 5000);
});

// Funzioni aggiuntive addEntryItem, updateTotals ecc. da aggiungere qui
</script>
</body>
</html>
